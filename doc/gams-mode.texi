\input texinfo
@setfilename gams-mode.info
@settitle GAMS Mode

@dircategory Emacs Modes
@direntry
* GAMS Mode: (gams-mode).   Edit and manage General Algebraic Modeling System projects.
@end direntry

@copying
Copyright @copyright{} 2001--2025 Shiro Takeda

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with no Front-Cover Texts, and with no Back-Cover
Texts.
@end copying

@titlepage
@title GAMS Mode Manual
@subtitle Editing and running GAMS models from Emacs
@author Shiro Takeda

@page
@vskip 0pt plus 1filll
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with no Front-Cover Texts, and with no Back-Cover
Texts.
@end titlepage

@contents

@ifnottex
@node Top
@top GAMS Mode
@insertcopying
@menu
* Introduction::
* Installing GAMS Mode::
* Installing GAMS from Emacs::
* Getting Started::
* Viewing Solver Output::
* Configuration and Customization::
* Reference::
* Troubleshooting::
* Copying::
@end menu
@end ifnottex

@node Introduction
@chapter Introduction
@cindex GAMS
@cindex Algebraic modeling

GAMS mode integrates the General Algebraic Modeling System (GAMS) with
Emacs.  It provides a major mode for authoring @file{.gms} files,
specialized viewers for solver output, and utilities that streamline the
workflow of editing, running, and analysing GAMS projects inside Emacs.

The mode is distributed through GNU ELPA-compatible archives (MELPA and
MELPA Stable) and may also be installed manually from the project
repository.  This manual describes the features that GAMS mode adds to
Emacs, how to configure it, and how to invoke the commands that support
editing and running models.

@section Major components

GAMS mode installs several major modes, each tailored to a different
stage of the GAMS workflow.

@itemize
@item @code{gams-mode} edits model source files.
@item @code{gams-lst-mode} views solver listings (@file{.lst}).
@item @code{gams-sil-mode} presents a structural outline of model
elements.
@item @code{gams-template-mode} manages code templates and snippets.
@item @code{gams-outline-mode} highlights important entries in listing
files.
@end itemize

All modes share consistent key bindings and menu entries.  The sections
that follow explain how to install the package, run the auxiliary tools,
and adapt the behaviour through customization interfaces.

@node Installing GAMS Mode
@chapter Installing GAMS Mode
@cindex Installation

@section Installing from MELPA

The recommended method is to install the package from MELPA or MELPA
Stable.  Add the archive to @code{package-archives} in
@file{init.el} when necessary:

@lisp
(add-to-list 'package-archives
             '("melpa" . "https://melpa.org/packages/") t)
(add-to-list 'package-archives
             '("melpa-stable" . "https://stable.melpa.org/packages/") t)
@end lisp

Then run @kbd{M-x package-refresh-contents RET} followed by
@kbd{M-x package-install RET gams-mode RET}.  The MELPA build installs
the Lisp sources that power the major modes.  Optional sample files and
documentation remain in the repository and may be downloaded
separately.

When the GAMS executable is not available on the @env{PATH}, set
@code{gams-process-command-name} to its absolute location, e.g.

@lisp
(setopt gams-process-command-name "c:/GAMS/48/gams.exe")
@end lisp

With the executable configured, visiting a file whose extension matches
@code{gams-mode-file-regexp} (such as @file{.gms} or @file{.inc})
activates GAMS mode automatically.

@section Manual installation

For a manual setup, place @file{gams-mode.el} and auxiliary files in a
directory that Emacs can load. Add the directory to @code{load-path} and
require the package:

@lisp
(add-to-list 'load-path "~/emacs.d/lisp/gams/")
(require 'gams-mode)
@end lisp

Copy the sample template @file{gams-template.txt} to
@file{~/.emacs.d/} to make predefined templates available, and review
@file{gams-setting-sample.el} for configurable options and helper
functions.

@node Installing GAMS from Emacs
@chapter Installing GAMS from Emacs
@cindex gams-install.el

The package @file{gams-install.el} automates the installation of the
GAMS distribution itself.  It fetches the official installers for
Windows, macOS, and GNU/Linux and runs a platform-specific script that
performs the installation.

Administrative privileges are required on macOS and GNU/Linux because
the scripts install system-wide files.

@section Commands

@table @kbd
@item M-x gams-install
Download and install the latest available GAMS release that matches the
current platform.

@item C-u M-x gams-install
Prompt for a specific release number before running the installer.

@item M-x gams-install-check-installation
Report the version of the @code{gams} executable found on
@env{PATH}.  When no executable is available, the command displays a
message explaining the situation.
@end table

Installations display progress inside the buffer named @samp{*GAMS
Installation*}.  The scripts print the final installation directory so
that it can be added to @env{PATH} or referenced when configuring
@code{gams-process-command-name}.

@section Customization

@defopt gams-install-directory nil
Default installation directory for GNU/Linux systems.  Non-nil values
override the default of @file{/opt/gams}.  The variable is ignored on
Windows and macOS where the installers impose their own directory layout.
@end defopt

On macOS the installer deploys under
@file{/Library/Frameworks/GAMS.framework/Versions/Current/Resources/}.
Windows installations go under @file{C:\@/GAMS\<major version>}.

@node Getting Started
@chapter Getting Started

The file @file{sample_gams_code/gams-sample.gms} demonstrates most
features of the mode.  Visiting the file and following the instructions
in the comments is an effective way to explore the editing commands.

@section Basic workflow

@enumerate
@item Open or create a @file{.gms} file.  GAMS mode activates
automatically and enables syntax highlighting, indentation, and
navigation commands tailored to GAMS.
@item Invoke @kbd{f9} to run the model with the current settings.
The command saves the buffer when necessary, launches the @code{gams}
process, and shows progress in the compilation buffer.
@item Inspect the listing file via @kbd{C-c C-l}.  The LST viewer exposes
dedicated navigation keys and integration with @code{next-error}.
@item Use completion commands such as @kbd{C-c C-k} and @kbd{C-c C-d} to
insert statements and dollar control options without retyping them.
@end enumerate

@section Key bindings in GAMS mode
@cindex Key bindings, GAMS mode

This section lists all key bindings available in @code{gams-mode}.  All
commands are also available through @kbd{M-x} and the GAMS menu.

@subsection Code insertion and editing

@table @kbd
@item C-c C-k
@findex gams-insert-statement
Insert a GAMS statement with completion support.  Prompts for a statement
name and inserts it at point.  The casing follows
@code{gams-completion-case}.

@item C-c C-d
@findex gams-insert-dollar-control
Insert a dollar control option with completion.  Similar to
@kbd{C-c C-k} but for dollar control options like @code{$include},
@code{$ontext}, etc.

@item C-c C-n
@findex gams-insert-statement-extended
Insert a GAMS statement in extended mode, which provides additional
context-aware features.

@subsection Comments

@item C-c C-o
@findex gams-insert-comment
Insert a user-defined comment template as specified in
@code{gams-user-comment}.  The template may include a @samp{%} marker
indicating where the cursor should be placed after insertion.

@item C-c C-c
@findex gams-insert-on-off-text
Insert an @code{$ontext}--@code{$offtext} pair for block comments.  When
used with a prefix argument (@kbd{C-u C-c C-c}), enclose the current
region in an @code{$ontext}--@code{$offtext} pair.

@item C-c C-g
@findex gams-jump-on-off-text
Jump between matching @code{$ontext} and @code{$offtext} delimiters.

@item C-c M-c
@findex gams-comment-on-off-text
Comment or uncomment an @code{$ontext}--@code{$offtext} pair.

@item C-c M-g
@findex gams-remove-on-off-text
Remove the surrounding @code{$ontext} and @code{$offtext} lines, leaving
the enclosed text in place.

@item C-c C-;
@findex gams-comment-dwim-inline
@findex gams-comment-or-uncomment-region
Insert or manipulate inline comments.  This command is also aliased to
@code{comment-or-uncomment-region}, allowing you to comment or uncomment
a selected region.

@item C-c M-;
@findex gams-comment-dwim
Insert or manipulate end-of-line comments.  The comment symbol is
determined by @code{gams-eolcom-symbol-default} or any active
@code{$eolcom} directive in the buffer.
@end table

@subsection Running GAMS and viewing output

@table @kbd
@item C-c C-s
@itemx f9
@findex gams-start-processor
Run GAMS on the current file and display the process buffer.  The buffer
is saved automatically before execution.  Output appears in a buffer named
@samp{*GAMS*}.

@item C-u C-c C-t
Edit the GAMS command line and options before starting execution.

@item C-c C-t
@findex gams-start-menu
Open the process menu, which offers options to run GAMS, kill the running
process, change command-line options, or select a different GAMS
executable.

@item C-c C-l
@findex gams-popup-process-buffer
Display the GAMS process buffer in another window.  Useful when
@code{gams-always-popup-process-buffer} is set to @code{nil}.

@item C-c C-v
@itemx f10
@findex gams-view-lst
Switch to the LST file corresponding to the current GMS file.  If errors
are present, position point at the first error.  With a prefix argument
(@kbd{C-u C-c C-v}), display the LST file in a side-by-side window
layout.

@item C-c C-j
@findex gams-jump-to-lst
Switch to the LST file without checking for errors.

@item C-c C-i
@itemx f11
@findex gams-from-gms-to-outline
Jump directly from the GMS file to the GAMS-OUTLINE buffer, bypassing the
LST file view.
@end table

@subsection Navigation and inspection

@table @kbd
@item C-c C-.
@itemx f7
@findex gams-show-identifier
Show the declaration of the identifier at point.  When invoked on a
variable, equation, parameter, or set name, this command searches for and
displays its definition.  Use it to quickly review declarations while
editing.

@item C-c C-a
@findex gams-show-identifier-list
Display a structured list of all identifiers (sets, parameters, variables,
equations) defined in the current buffer and any included files.  The
list is shown in GAMS-SIL mode, which provides navigation and filtering
commands.

@item C-c C-w
@findex gams-open-included-file
Open the file referenced in an @code{$include} or @code{$batinclude}
directive at point.  Place the cursor on or near the file name and invoke
this command to visit the included file.

@item f8
@findex gams-goto-matched-paren
Jump to the matching parenthesis.  This command works when point is on an
opening or closing parenthesis, similar to the @kbd{%} command in vi or
the @kbd{f8} key in GAMS Studio.
@end table

@subsection Documentation and help

@table @kbd
@item C-c C-m
@findex gams-view-document
Browse the GAMS documentation.  The browser is selected according to
@code{gams-browse-url-function}.  Setting that variable to
@code{xwidget-webkit-browse-url} opens the documentation inside Emacs on
systems with Xwidgets support.

@item C-c C-z
@findex gams-model-library
Open the GAMS model library browser.  This command allows you to search,
view, and extract example models from the GAMS distribution.
@end table

@subsection Templates and customization

@table @kbd
@item C-c C-e
@findex gams-template
Enter GAMS-TEMPLATE mode to insert, edit, or manage code templates.
Templates are stored in @code{gams-template-file} and provide reusable
code fragments for common patterns.

@item C-c C-f
@findex gams-choose-font-lock-level
Cycle through font-lock (syntax highlighting) levels.  GAMS mode supports
multiple levels of colorization.  Use this command to select the level
that balances visual clarity and performance.
@end table

@subsection Window and buffer management

@table @kbd
@item C-l
Recenter the window so that point is in the middle of the screen.  If
@code{gams-recenter-font-lock} is non-nil, the visible portion of the
buffer is refontified as well.

@item C-c C-h
@findex gams-toggle-hide-show-comment-lines
Toggle visibility of all comment lines (lines starting with @samp{*} or
enclosed in @code{$ontext}--@code{$offtext} blocks).  This command uses
Emacs' selective display feature and does not modify the buffer contents.

@item C-c C-x
@findex gams-open-gdx
Open the GDX file associated with the current model.  If a file matching
the model name is found, it is opened in GAMS Studio.  Otherwise, the
command prompts for a GDX file to open.
@end table

@subsection Outline navigation

When @code{outline-minor-mode} features are enabled, these additional
bindings provide headline-based navigation:

@table @kbd
@item TAB
@findex org-cycle
Cycle the visibility of the current outline section.  Successive
invocations toggle between showing and hiding the body of the section.

@item S-TAB
@findex org-global-cycle
Cycle the visibility of the entire buffer.  Use this to collapse or expand
all outline sections at once.

@item C-c C-: n
@findex outline-next-visible-heading
Move to the next visible headline.

@item C-c C-: p
@findex outline-previous-visible-heading
Move to the previous visible headline.

@item C-c C-: f
@findex gams-org-fold-current-tree
Fold the current outline tree, hiding its contents.

@item C-c C-: k
@findex show-branches
Show the structure of the current section without revealing the body text.
@end table

@section Auto-completion
@cindex Completion

Completion is provided through Emacs' standard
@code{completion-at-point-functions}.  Use @kbd{C-M-i} or @kbd{M-TAB} to
trigger the completions for statements, control options, and symbols
discovered in the current buffer.  Dynamic abbreviation expansion
(@kbd{M-/}) integrates well with model editing.

When @code{company-mode} is enabled, the default backends are configured
through @code{gams-company-backends}, combining file completion,
snippets, dynamic abbreviations, and the built-in GAMS completion
sources.

@section Template management

Templates allow frequently used code fragments to be inserted quickly.
GAMS Template mode offers commands to create, rename, delete, and
reorder template entries.  The default template file is
@file{~/.emacs.d/gams-template.txt}.  A sample file ships with the
package.

@node Viewing Solver Output
@chapter Viewing Solver Output
@cindex Listing files
@cindex GAMS LST mode

@code{gams-lst-mode} provides navigation facilities for listing files.
It derives from @code{special-mode} and adds key bindings that jump
between errors and sections.

@section Key bindings in GAMS-LST mode
@cindex Key bindings, GAMS-LST mode

The following key bindings are available when viewing LST files.  All
commands work in @code{view-mode}, which means the buffer is read-only
and provides special navigation features.

@subsection Error navigation and file jumping

@table @kbd
@item y
@findex gams-lst-view-error
Jump to the first error in the listing file and display its error number
and message in the minibuffer.  This command positions point at the error
location and shows the error details.

@item u
@findex gams-lst-jump-to-error-file
Jump back to the error location in the input (GMS) file.  Use this after
examining an error with @kbd{y} to return to the source code where the
error occurred.

@item i
@findex gams-lst-jump-to-input-file
Jump to the corresponding location in the input (GMS) file.  This works
for any line in the LST file that references the source, not just errors.

@item b
@findex gams-lst-jump-to-input-file-2
Alternative command to jump to the input file, providing slightly
different behavior in some contexts.

@item l
@findex gams-lst-jump-to-line
Jump to a specific line number in the listing file.  Prompts for a line
number and moves point there.

@item L
@findex gams-lst-jump-to-line
Jump to a line you specify, with additional prompting features.
@end table

@subsection Navigation within the listing

@table @kbd
@item s
@findex gams-lst-next-solve-summary
Jump to the next SOLVE SUMMARY section in the listing.

@item S
@findex gams-lst-previous-solve-summary
Jump to the previous SOLVE SUMMARY section.

@item r
@findex gams-lst-next-report-summary
Jump to the next REPORT SUMMARY section.

@item R
@findex gams-lst-previous-report-summary
Jump to the previous REPORT SUMMARY section.

@item v
@findex gams-lst-next-variable
Jump to the next VAR (variable) entry.

@item V
@findex gams-lst-previous-variable
Jump to the previous VAR entry.

@item e
@findex gams-lst-next-equation
Jump to the next EQU (equation) entry.

@item E
@findex gams-lst-previous-equation
Jump to the previous EQU entry.

@item p
@findex gams-lst-next-parameter
Jump to the next PARAMETER entry in the listing.

@item P
@findex gams-lst-previous-parameter
Jump to the previous PARAMETER entry.

@item x
@findex gams-lst-next-elt
Jump to the next Equation Listing section in the output.

@item X
@findex gams-lst-previous-elt
Jump to the previous Equation Listing section.

@item c
@findex gams-lst-next-clt
Jump to the next Column Listing section.

@item C
@findex gams-lst-previous-clt
Jump to the previous Column Listing section.

@item .
@findex gams-lst-file-summary
Display a summary of the listing file, showing key statistics and
sections.
@end table

@subsection Buffer and window management

@table @kbd
@item q
@findex gams-lst-quit
Close the LST buffer and return to the previous buffer configuration.

@item ?
Display help information for GAMS-LST mode, showing all available key
bindings and their descriptions.

@item o
@itemx O
@findex gams-outline
@findex gams-outline-external
Open GAMS-OUTLINE mode for the current listing.  @kbd{O} invokes an
external program for faster processing of large files.

@item SPACE
@findex scroll-up
Scroll the listing buffer up (forward) by one screenful.

@item DELETE
@itemx BACKSPACE
@findex scroll-down
Scroll the listing buffer down (backward) by one screenful.

@item d
@findex gams-lst-scroll-1
Scroll down by one line without moving point.

@item f
@findex gams-lst-scroll-2
Scroll up by one line without moving point.

@item g
@findex gams-lst-scroll-page-2
Scroll down by half a page without moving point.

@item h
@findex gams-lst-scroll-page-1
Scroll up by half a page without moving point.

@item j
@findex gams-lst-scroll-3
Scroll to the left, useful for wide listings.

@item k
@findex gams-lst-scroll-4
Scroll to the right.

@item 1
@findex delete-other-windows
Widen the current LST window to fill the entire frame.

@item 2
@findex split-window-vertically
Split the window vertically, showing two views of the listing or allowing
another buffer to be displayed.

@item m
@findex gams-lst-move-frame
Move the frame to a different position on the screen.  Useful for
organizing multiple frames.

@item w
@findex gams-lst-resize-frame
Resize the current frame to a convenient layout for inspecting solver
output.

@item z
@findex other-window
Move the cursor to the other window when the frame is split.
@end table

@subsection Additional features

@table @kbd
@item C-c C-x
@findex gams-open-gdx
Open the GDX file associated with the current model.  If a file with the
same base name exists, it is opened in GAMS Studio; otherwise, the
command prompts for a file.

@item g
@findex revert-buffer
Revert the buffer to reflect the most recent run.  This reloads the LST
file from disk, useful when re-running the model.
@end table

@section Outline and SIL modes

@code{gams-outline-mode} extracts and highlights relevant lines from the
listing file.  It is entered with @kbd{o} from LST mode.  Press
@kbd{?} in the outline buffer for a summary of navigation commands.

@code{gams-sil-mode} presents a structural outline of the source file,
grouping symbols such as sets, parameters, variables, and equations.
Use it to navigate large models quickly.

@node Configuration and Customization
@chapter Configuration and Customization
@cindex Customization
@cindex Options

All customization variables belong to the customization group
@code{gams}.  Access it via @kbd{M-x customize-group RET gams RET}.
This chapter lists the most frequently tuned variables.

@defopt gams-process-command-name (executable-find "gams")
Name or absolute file name of the GAMS executable.  When the executable
is not on @env{PATH}, point this variable to the desired binary, e.g.
@code{"c:/GAMS/48/gams.exe"}.
@end defopt

@defopt gams-system-directory (file-name-directory gams-process-command-name)
Directory that contains the installed GAMS system files.  The directory
is used to construct paths to documentation and auxiliary binaries.
@end defopt

@defopt gams-process-command-option "logOption=3 pageWidth=100"
Default command-line options passed to the GAMS executable.  To enable
@code{next-error} integration ensure that @code{logLine} is set to @code{1}
or @code{2} (the default).
@end defopt

@defopt gams-statement-file
  (concat user-emacs-directory "gams-statement.txt")
File that stores user-defined statements and dollar control options.
The file is updated automatically when new entries are registered from
the insertion commands.
@end defopt

@defopt gams-company-backends
  '((company-files company-yasnippet company-dabbrev-code company-capf :separate))
List of completion backends used when @code{company-mode} is active in
GAMS buffers.
@end defopt

@defopt gams-completion-case 'CamelCase
Preferred casing of inserted statements.  Valid values are
@code{CamelCase}, @code{lowercase}, and @code{UPPERCASE}.
@end defopt

@defopt gams-fill-column 80
Fill column used when wrapping comments and statements through
@code{fill-paragraph} and @code{auto-fill-mode}.
@end defopt

@defopt gams-mode-hook nil
Hook run after @code{gams-mode} initializes.  Use it to enable auxiliary
minor modes or buffer-local settings.
@end defopt

@defopt gams-close-paren-always t
When non-nil, insert the matching closing parenthesis automatically.
@end defopt

@defopt gams-close-double-quotation-always t
When non-nil, insert the closing double quote automatically after typing
@samp{"}.
@end defopt

@defopt gams-dollar-control-upcase nil
When non-nil, insert dollar control options in uppercase by default.
@end defopt

@defopt gams-use-mpsge t
Enable features that integrate with MPSGE models.
@end defopt

@section Process options

Several variables configure how the mode interacts with the external
GAMS process and how results are displayed.

@defopt gams-always-popup-process-buffer t
When non-nil, display the GAMS process buffer whenever a run is started.
Disable this option to leave the current window configuration untouched.
@end defopt

@defopt gams-process-log-to-file nil
When non-nil, append process output to a log file in addition to the
process buffer.  The log file name is derived from
@code{gams-log-file-extension}.
@end defopt

@defopt gams-log-file-extension "log"
Extension used when creating log files for process output.
@end defopt

@defopt gams-browse-url-function 'browse-url
Function used to open the GAMS documentation.  Set this to
@code{xwidget-webkit-browse-url} to view the manuals inside Emacs when
Xwidgets are available.
@end defopt

These options, among others defined in @file{gams-mode.el}, can be
modified via Customize or by calling @code{setopt}.

@node Reference
@chapter Reference

This chapter summarises additional commands that complement the editing
workflow.

@defun gams-open-gdx
Open the GDX file that shares its name with the current model.  When the
file is not found, prompt for a GDX file and open it in GAMS Studio.
@end defun

@defun gams-view-document
Display GAMS documentation.  The browsing function is controlled by
@code{gams-browse-url-function}.  On Emacs builds with Xwidgets support,
setting the variable to @code{xwidget-webkit-browse-url} opens the
manuals inside Emacs.
@end defun

@defun gams-clean-files-and-folders
Remove files and directories generated by GAMS runs in the current
project directory.  Delete files matching @file{*.g00}, @file{*.gdx},
@file{*.lst}, @file{*.log}, @file{*.lxi}, @file{*.ref}, and folders
named @file{225*}.
@end defun

@section Sample resources

The distribution includes sample files that illustrate the mode's
features:

@itemize
@item @file{sample_gams_code/} contains models referenced by the
documentation, including @file{gams-sample.gms} and outline samples.
@item @file{gams-setting-sample.el} demonstrates a full configuration.
@item @file{gams-template.txt} provides ready-to-use code templates.
@item @file{doc/refcard-gams.pdf} offers a printable reference card for
the major commands and key bindings.
@end itemize

@node Troubleshooting
@chapter Troubleshooting

The file @file{BUGS_PROBLEMS.md} lists known issues and workarounds.  In
addition, the following checks resolve common installation problems:

@itemize
@item Ensure that @code{gams-process-command-name} points to a valid
executable.  Use @kbd{M-x gams-install-check-installation} to verify the
detected version.
@item Confirm that @code{logLine} is set to @code{1} or @code{2} in
@code{gams-process-command-option} so that @code{next-error} can parse
log entries correctly.
@item Increase @code{jit-lock-chunk-size} when editing models with large
blocks such as @code{$ontext} sections to keep font locking responsive.
@end itemize

@node Copying
@appendix Copying

The full text of the GNU Free Documentation License, Version 1.3, is
available from @url{https://www.gnu.org/licenses/fdl-1.3.html}.  This
manual is distributed under that license as stated in the copying
notice.

@bye
